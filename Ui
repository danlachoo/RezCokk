-- ModuleScript (Ui)

local UI_Module = {}

function UI_Module.CreateUI(parent, params)
    -- Создание основного фрейма
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Parent = parent

    local MainFrame = Instance.new("Frame")
    MainFrame.Size = UDim2.new(0, 645, 0, 356)
    MainFrame.Position = UDim2.new(0.262, 0, 0.213, 0)
    MainFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    MainFrame.Active = true  -- Делаем фрейм активным для перетаскивания
    MainFrame.Draggable = true  -- Делаем фрейм перетаскиваемым
    MainFrame.Parent = ScreenGui

    -- Настройка ImageLabel для основной иконки
    local ImageLabel = Instance.new("ImageLabel")
    ImageLabel.Size = UDim2.new(0, 52, 0, 52)
    ImageLabel.Position = UDim2.new(0, 0, 0, 0)
    ImageLabel.Image = "rbxassetid://" .. tostring(params.Icon or 18663149111)
    ImageLabel.BackgroundTransparency = 1  -- Убираем задний фон
    ImageLabel.Parent = MainFrame

    -- Настройка TextLabel для основного текста
    local TextLabel = Instance.new("TextLabel")
    TextLabel.Size = UDim2.new(0, 200, 0, 50)
    TextLabel.Position = UDim2.new(0.057, 0, 0, 0)
    TextLabel.BackgroundTransparency = 1
    TextLabel.TextScaled = true
    TextLabel.Font = Enum.Font.SourceSansBold
    TextLabel.Text = params.name or "Your Text Here"  -- Используем имя из переданных параметров
    TextLabel.TextColor3 = Color3.new(1, 1, 1)
    TextLabel.Parent = MainFrame

    -- Настройка кнопки закрытия
    local CloseButton = Instance.new("TextButton")
    CloseButton.Size = UDim2.new(0, 32, 0, 32)
    CloseButton.Position = UDim2.new(0.969, 0, 0, 0)
    CloseButton.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
    CloseButton.TextScaled = true
    CloseButton.Font = Enum.Font.SourceSansBold
    CloseButton.Text = "X"
    CloseButton.TextColor3 = Color3.new(1, 1, 1)
    CloseButton.Parent = MainFrame

    -- Закрытие окна при нажатии на кнопку
    CloseButton.MouseButton1Click:Connect(function()
        ScreenGui:Destroy()
    end)

    -- Переменные для перетаскивания
    local dragging = false
    local dragInput, mousePos, framePos

    -- Функция для начала перетаскивания
    local function onInputBegan(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            mousePos = input.Position
            framePos = MainFrame.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end

    -- Функция для перетаскивания
    local function onInputChanged(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end

    -- Функция для обновления позиции при перетаскивании
    local function update(input)
        if dragging then
            local delta = input.Position - mousePos
            MainFrame.Position = UDim2.new(framePos.X.Scale, framePos.X.Offset + delta.X, framePos.Y.Scale, framePos.Y.Offset + delta.Y)
        end
    end

    -- Подключение функций к событиям
    MainFrame.InputBegan:Connect(onInputBegan)
    MainFrame.InputChanged:Connect(onInputChanged)
    game:GetService("UserInputService").InputChanged:Connect(update)

    -- Добавление дополнительного интро текста и иконки, если указаны
    if params.IntroText or params.IntroIcon then
        local IntroFrame = Instance.new("Frame")
        IntroFrame.Size = UDim2.new(1, 0, 0.3, 0)
        IntroFrame.Position = UDim2.new(0, 0, 0.7, 0)
        IntroFrame.BackgroundTransparency = 1
        IntroFrame.Parent = MainFrame

        if params.IntroIcon then
            local IntroIcon = Instance.new("ImageLabel")
            IntroIcon.Size = UDim2.new(0, 52, 0, 52)
            IntroIcon.Position = UDim2.new(0.1, 0, 0.2, 0)
            IntroIcon.Image = "rbxassetid://" .. tostring(params.IntroIcon)
            IntroIcon.BackgroundTransparency = 1
            IntroIcon.Parent = IntroFrame
        end

        if params.IntroText then
            local IntroText = Instance.new("TextLabel")
            IntroText.Size = UDim2.new(0.8, 0, 0.5, 0)
            IntroText.Position = UDim2.new(0.2, 0, 0.25, 0)
            IntroText.BackgroundTransparency = 1
            IntroText.TextScaled = true
            IntroText.Font = Enum.Font.SourceSansBold
            IntroText.Text = params.IntroText
            IntroText.TextColor3 = Color3.new(1, 1, 1)
            IntroText.Parent = IntroFrame
        end
    end

    return ScreenGui
end

return UI_Module
